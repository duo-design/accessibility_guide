<html>
  <head>
    <style type="text/css">
      :root {
        color: #000;
        font-family: "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif;
        font-size: 18px;
        line-height: 1.5;
      }

      main {
        padding-top: 1.5rem;
        padding-bottom: 2rem;
      }

      h2, h3, h4 {
        margin-top: 1.5em;
        margin-bottom: 0;
      }

      h2 {
        border-top: 2px solid black;
        margin-top: 1em;
        padding-top: 0.5em;
      }

      aside h2:first-child,
      aside h3:first-child,
      aside h4:first-child {
        margin-top: 0;
      }

      h1 { font-size: 2.5rem }
      h2 { font-size: 2rem }
      h3 { font-size: 1.5rem }
      h4 { font-size: 1rem }

      p, ul, ol {
        max-width: 35rem;
      }

      main {
        --content-size: 35rem;
        --note-size: 25rem;
        --gap: 2rem;
        width: calc(var(--content-size) + var(--note-size) + var(--gap));
        margin: 0 auto;
        display: grid;
        grid-template-columns: var(--content-size) var(--note-size);
        grid-gap: 0 var(--gap);
      }

      main > .document-header,
      main > h2 {
        grid-column: 1 / -1;
        width: 100%;
      }

      main > * {
        grid-column: 1;
        margin-left: 0;
      }

      main > aside {
        grid-column: 2;
        margin-left: 0;
      }

      table {
        border-spacing: 0;
        border-collapse: collapse;
        margin-top: 2rem;
        margin-bottom: 2rem;
      }

      td,
      th {
        padding: 0.5rem;
        font-size: 14px;
        text-align: left;
        border: 1px solid #999;
        background-color: #fff;
      }

      td {
        background-color: #fee;
      }

      td.minimum,
      .minimum ~ td {
        background-color: #def;
      }

      td.better,
      .better ~ td {
        background-color: #cfe;
      }

      td.limit,
      .limit ~ td {
        background-color: #fee;
      }

      li {
        margin-top: 1rem;
      }
    </style>
  </head>

  <body>
    <main>
      <h1 class="document-header">
        Duo Color Palette Accessibility Requirements
      </h1>

      <h2>
        Introduction
      </h2>

      <div>
        <h3>
          What this document is
        </h3>

        <ul>
          <li>
            This document aims to be a complete list of the requirements Duo will use to check if a color palette meets Duo's accessibility needs.
          </li>

          <li>
            This document is a combination of current laws, standards, new guidelines that might be incorporated into future standards, industry best practices, and scientific research into how to create highly legible UI's for people with a wide range of disabilities.
          </li>

          <li>
            Unless otherwise mentioned, the items listed in this document are requirements, not nice to haves.
          </li>
        </ul>

        <h3>
          What this document is not
        </h3>

        <ul>
          <li>
            This is not comprehensive list of all accessibility guidelines and laws related to color. We have summarized and condensed many rules and guidelines to the essentials. If these core requirements can be met, the rest should be able to be met as well.
          </li>
          <li>
            This is not guide for how to design accessible components using colors.
          </li>
        </ul>
      </div>

      <aside>
        <h3>
          Motivation
        </h3>

        <p>
          We want a color palette that go beyond the basic legal requirements. We want palette that allows designers to create a great user experience for all sighted people, regardless of their visual acuity or color vision.
        </p>

        <p>
          In the past we have tried iterate on color palettes with quick informal accessibility reviews using the common best practices. Over time, some nasty edge cases were found that were hard to address with incremental improvements, and we learned that some common best practices were based on dated recommendations, or gave some people a degraded experience. To address this, we looked into what research has been done on human vision, readability, and color accessibility, then worked on turning our learnings into this set of requirements.
        </p>
      </aside>

      <h2>
        Contrast
      </h2>

      <div>
        <p>
          These requirements are to ensure that text is readable and graphics are visible for people with a wide range of visual acuity and color perception. These measurements can not be used to tell how different objects look from one another based on color. <br> <a href="#distinct-colors">See note on measuring color differences.</a>
        </p>

        <p>
          All contrast requirements must be met against all background a color content will appear against in all themes. This is because some people with low vision need to use light mode as brighter backgrounds make it easier for them to read text. Others may need to use dark mode because they are sensitive to bright lights. Special accessibility themes are not viable because they create more work for designers and engineers, and some users don't have a choice about what theme an application uses because they are on a public device, or they have to pick one global setting for another piece of software to work for them.
        </p>
      </div>

      <aside>
        <h4 id="distinct-colors">
          Can't we use contrast measurements to measure color differences?
        </h4>

        <p>
          In many cases two colors need to look different. For example, links need to look different from plain text. Unfortunately, WCAG 2 contrast doesn't match human perception, and APCA measures how much contrast an object has against it's background. There is no good empirical measurement for how different one color looks from another.
        </p>

        <p>
          A good measurement would be very hard to create because perceived color is context dependent. Two colors that look similar next to each other can look different when placed in different parts of a page, and visa versa. Even worse, two objects with the same actual color can have different perceived colors depending on context, and visa versa.
        </p>


        <h4 id="wcag-3">
          What about WCAG 3?
        </h4>

        <p>
          Some blog posts, tweets and tools incorrectly mention "WCAG 3 requirements". WCAG 3 is still being written, it isn't an adopted standard. As of the writing of this document, the published draft of WCAG 3 doesn't contain any requirements, only initial thoughts on how WCAG 3 will be structured. APCA has been proposed as a measurement that could be used by WCAG 3, but APCA is still in beta and we don't know if it will be adopted by WCAG3 and how the measurements might be used by the standard.
        </p>
      </aside>

      <h3>
        WCAG 2 AA contrast
      </h3>

      <div>
        <p>
          These requirements help us meet legal our customer's legal needs. Due to differences in the way contrast is calculated, we must meet these as well as APCA requirements. APCA alone doesn't ensure legal compliance.
        </p>

        <p>
          Disabled text has no contrast requirements under WCAG 2, nor do logos.
        </p>

        <table>
          <tr>
            <th></th>
            <th>3:1</th>
            <th>4.5:1</th>
          </tr>
          <tr>
            <th>
              Medium and small text
            </th>
            <td data-wcag="3:1"></td>
            <td data-wcag="4.5:1" class="minimum">Minimum</td>
          </tr>
          <tr>
            <th>
              Large text
            </th>
            <td data-wcag="3:1" class="minimum">Minimum</td>
            <td data-wcag="4.5:1"></td>
          </tr>
          <tr>
            <th>
              Non-text components
              <br>
              (icons, buttons edges, input borders, etc)
            </th>
            <td data-wcag="3:1" class="minimum">Minimum</td>
            <td data-wcag="4.5:1"></td>
          </tr>
        </table>
      </div>

      <aside>
        <h4>
          What about WCAG 2 AAA contrast?
        </h4>
        <p>
          Previously we used WCAG 2 AAA when high legibility was important. However, the WCAG 2 contrast algorithm is flawed. Even at AAA levels, some hard to read colors pass. APCA provides a better way to set higher legibility requirements and helps us filter out hard to read color pairs that pass WCAG 2 AA.
        </p>

        <h4>
          What about Bridge-PCA?
        </h4>

        <p>
          Bridge-PCA is an attempt to merge WCAG 2 and APCA into one measurement. We don't use it because we want to be able to be able to make trade-off decisions based on current legal requirements, things that might become legal requirements in the future, and best practices. One combined measurement makes it harder discern the difference between those three things.
        </p>
      </aside>

      <h3>
        APCA contrast
      </h3>

      <div>
        <p>
          These are contrast measurements we have to meet or exceed to ensure great legibility. These requirements will also reduce the chances that we need to update our palette if/when WCAG and legal standards start using a better color contrast measurement.
        </p>

        <table>
          <tr>
            <th></th>
            <th>Lc 15</th>
            <th>Lc 30</th>
            <th>Lc 45</th>
            <th>Lc 60</th>
            <th>Lc 75</th>
            <th>Lc 90</th>
          </tr>

          <tr>
            <th>
              Block of plain text
            </th>
            <td data-lc="15"></td>
            <td data-lc="30"></td>
            <td data-lc="45"></td>
            <td data-lc="60"></td>
            <td data-lc="75"></td>
            <td data-lc="90" class="minimum">Minimum</td>
          </tr>

          <tr>
            <th>
              Shorter text
              <br>
              (labels, inputs, etc)
            </th>
            <td data-lc="15"></td>
            <td data-lc="30"></td>
            <td data-lc="45"></td>
            <td data-lc="60"></td>
            <td data-lc="75" class="minimum">Minimum</td>
            <td data-lc="90" class="better">Better</td>
          </tr>

          <tr>
            <th>
              Headings
            </th>
            <td data-lc="15"></td>
            <td data-lc="30"></td>
            <td data-lc="45"></td>
            <td data-lc="60"></td>
            <td data-lc="75" class="minimum">Minimum</td>
            <td data-lc="90" class="limit">Do not exceed</td>
          </tr>

          <tr>
            <th>
              Link text
            </th>
            <td data-lc="15"></td>
            <td data-lc="30"></td>
            <td data-lc="45"></td>
            <td data-lc="60"></td>
            <td data-lc="75" class="minimum">Minimum</td>
            <td data-lc="90" class="limit"><a href="#link-contrast">See note on links</a></td>
          </tr>

          <tr>
            <th>
              Button text
            </th>
            <td data-lc="15"></td>
            <td data-lc="30"></td>
            <td data-lc="45"></td>
            <td data-lc="60"></td>
            <td data-lc="75" class="minimum">Minimum</td>
            <td data-lc="90" class="better">Better</td>
          </tr>

          <tr>
            <th>
              Data visualizations
            </th>
            <td data-lc="15"></td>
            <td data-lc="30"></td>
            <td data-lc="45" class="minimum">Minimum</td>
            <td data-lc="60" class="better">Better</td>
            <td data-lc="75"></td>
            <td data-lc="90"></td>
          </tr>

          <tr>
            <th>
              Button and input borders
              <br>
              <a href="#buttons">See section on buttons</a>
            </th>
            <td data-lc="15"></td>
            <td data-lc="30"></td>
            <td data-lc="45" class="minimum">Minimum</td>
            <td data-lc="60" class="better">Better</td>
            <td data-lc="75"></td>
            <td data-lc="90"></td>
          </tr>

          <tr>
            <th>
              Button fill
              <br>
              <a href="#buttons">See section on buttons</a>
            </th>
            <td data-lc="15"></td>
            <td data-lc="30" class="minimum">Minimum</td>
            <td data-lc="45"></td>
            <td data-lc="60" class="better">Better</td>
            <td data-lc="75"></td>
            <td data-lc="90"></td>
          </tr>

          <tr>
            <th>
              Disabled input, button and placeholder text
            </th>
            <td data-lc="15"></td>
            <td data-lc="30" class="minimum">Minimum</td>
            <td data-lc="45" class="limit">No upper limit, but can't be confused with plain text</td>
            <td data-lc="60"></td>
            <td data-lc="75"></td>
            <td data-lc="90"></td>
          </tr>

          <tr>
            <th>
              Section divider lines
            </th>
            <td data-lc="15" class="minimum">Minimum</td>
            <td data-lc="30"></td>
            <td data-lc="45" class="better">Better</td>
            <td data-lc="60"></td>
            <td data-lc="75"></td>
            <td data-lc="90"></td>
          </tr>

          <tr>
            <th>
              Elevations
            </th>
            <td data-lc="15" class="minimum">Minimum</td>
            <td data-lc="30" class="better">Better</td>
            <td data-lc="45"></td>
            <td data-lc="60"></td>
            <td data-lc="75"></td>
            <td data-lc="90"></td>
          </tr>
        </table>
      </div>

      <aside>
        <h4>
          What is Lc?
        </h4>

        <p>
          "Lightness contrast" or Lc is the unit used by APCA to measure the perceived contrast levels. Light text against a dark background gets negative value, but you can ignore the negative sign when checking if a color passes in this table.
        </p>

        <h4>
          Why these components and values?
        </h4>

        <p>
          The components listed are illustrative of the most common use cases and those that past designs have struggled with the most. Some of values listed are the higher levels recommended for the best readability, rather than the bare minimums. Long term it is easier to create a color palette now that supports the highest levels of contrast than it is to create a palette that barely passes the minimums and needs to be extend in the future.
        </p>

        <h4>
          Doesn't APCA include size/weight requirements?
        </h4>

        <p>
          Yes, APCA's full recommendations also factor element size/weight. Our requirements factor those in. If a color palette can pass these contrast levels for the given components, we are confident that the palette has the flexibility we need. Rules to ensure components have the right size/weight to pass APCA's full recommendation can come later.
        </p>
      </aside>

      <h2>
        Data Visualizations
      </h2>

      <div>
        <ol>
          <li>
            There are at least 5 colors that can be used in data visualizations to separate different categories. Support for more colors is good.
          </li>
          <li>
            All categorical colors must have an obviously distinct value, hue and/or saturation for people with full color vision as well as those with deuteranopia, protanopia, and tritanopia. <br> <a href="#distinct-colors">See note on measuring color differences.</a>
          </li>
          <li>
            None of category colors could be confused with the colors of the most common interactive elements (links, primary and secondary buttons, etc) by people with full color vision as well as those with deuteranopia, protanopia, and tritanopia.
          </li>
        </ol>
      </div>

      <h2>
        Buttons
      </h2>

      <div id="buttons">
        <ol>
          <li>
            <p>
              Whatever visually element indicates "this is a button" needs to pass the relevant WCAG 2 and APCA contrast requirements.
            </p>
            <p>
              Some buttons look like buttons because of the border around them. Other buttons are defined visually by their fill color. These two have different contrast requirements because a thin border is harder to see than a solid colored block.
            </p>
          </li>
          <li>
            The text of a button always needs to meet the relevant contrast requirement when compared the background inside the button. If the button contains a gradient, the text needs to pass contrast rules against all colors in the gradient.
          </li>
          <li>
            There must be support for at least 4 semantically distinct button colors: primary and secondary (often grey and blue), as well as approve and deny (often green and red).
          </li>
          <li>
            All semantically distinct button colors must have an obviously distinct value, hue and/or saturation for people with full color vision as well as those with deuteranopia, protanopia, and tritanopia. <br> <a href="#distinct-colors">See note on measuring color differences.</a>
          </li>
        </ol>
      </div>

      <aside>
        <h4>
          What does "semantically distinct" mean?
        </h4>

        <p>
          "Semantically distinct" colors are colors where the hue or the fact that they look different from other buttons communicates something about what they do. Any time color is used to communicated semantics, we want the semantics to be the same for everyone, regardless of their color vision.
        </p>

        <p>
          We often make "Save", "Accept", "Next" and similar primary buttons a distinct color to make it easier for people to quickly identify buttons with a similar purpose: "this is the primary action".
        </p>

        <p>
          If there are buttons on separate parts of a page or on different pages that have distinct colors, it could be okay if they look the same to some people as long as being unable to distinguish the colors doesn't change the usability of the application. Them being different colors has no semantic meaning, it is just aesthetics.
        </p>

        <p>
          However, imagine we have a line of buttons next to one another, each with a unique color. Each color might not have a specific semantic meaning, but we do need them to look different for all people. Users would assume different things about the relationship between buttons in a line if they were all different colors versus if only some appeared to have the same color.
        </p>
      </aside>
      
      <h2>
        Link text
      </h2>

      <div>
        <ol>
          <li>
            Link text must have an obviously distinct hue and/or saturation when compared to plain text for people with full color vision as well as those with deuteranopia, protanopia, and tritanopia. <br> <a href="#distinct-colors">See note on measuring color differences.</a>
          </li>
        </ol>
      </div>

      <aside>
        <h3 id="link-contrast">
          Link contrast complications
        </h3>

        <p>
          While links don't have a maximum contrast ratio, a balance must be struck between having great contrast against the background for readability and having a visible difference from normal body text for people with and without color vision deficiencies. These two requirements are often in conflict, and some hues are especially difficult to get to pass both requirements in light or dark themes.
        </p>
      </aside>

      <h2>
        Recommended tools
      </h2>

      <h3>
        WCAG 2 contrast tools
      </h3>

      <p>
        Every plugin and tool we've tested measures WCAG 2 contrast correctly. WCAG 2 contrast is well established and the math is relatively simple. Use whatever ones you prefer.
      </p> 

      <h3>
        APCA contrast tools
      </h3>

      <p>
        Because APCA is under active development, some tools use outdated versions of the measurement, and any 3rd party tools we recommend now could become dated later. For critical tasks, <a href="https://www.myndex.com/apca/">the tool the creator of APCA hosts</a> should be considered the source of truth until the measurement is standardized. Any Figma plugin that matches the values found using that tool is okay.
      </p>

      <p>
        Note: APCA differentiates between the background and foreground (usually text) colors. Make sure your colors are in the correct fields as swapping them will alter the measured contrast.
      </p>

      <h3>
        Color vision simulators
      </h3>

      <div>
        <p>
          <a href="https://daltonlens.org/#software">DaltonLens for MacOS and Windows</a> is simulator that passes our accuracy requirements. To use it: grab a screen region, use the "DaltonLens Controls" window to select "Daltonize", check "Only simulate color vision deficiency", select the form of color blindess you wish to simulate, and make sure the severity is set to all the way up to 1.00.
        </p>

        <p>
          <a href="https://developer.chrome.com/blog/new-in-devtools-83/#vision-deficiencies">Chrome has simulators built into their dev tools</a> that will simulate the three most common forms of color vision deficiencies for whatever page you are looking at. The model they use is good enough for spot checking designs.
        </p>

        <p>
          We are actively trying to find a good Figma plugin. So far every one tested uses inaccurate models.
        </p>
      </div>

      <aside>
        <h4>
          Which forms of color vision deficiencies should we test?
        </h4>

        <p>
          We only recommend testing for dichromacy (protanopia, deuteranopia and tritanopia), which is when someone can't see one of the primary colors. Those three cover the needs of the vast majority of people with color vision deficiencies.
        </p>

        <p>
          You do not need to test for anomalous trichromacy (protanomaly, deuteranomaly and tritanomaly) as these are just less severe versions of dichromacy. Monochromacy isn't worth simulating for general design work. It comes a few different forms, is often accompanied by other severe visual disabilities, is misrepresented by most simulators (you can't just convert a design to greyscale), and there is little research into valid simulation techniques due to the rarity. Monochromacy can be accommodated with other design choices.
        </p>

        <h4>
          How do we validate color vision simulators?
        </h4>

        <p>
          We only recommend using simulators that use models based on peer reviewed research and validation with real people. <a href="https://daltonlens.org/opensource-cvd-simulation/">Currently the Brettel (1997) and Vienot (1999) models appear to be the best models available</a>. For tritanopia Brettel is preferred. For deuteranopia and protanopia Vienot is preferred. Simulators using the Machado (2009) model should be okay for spot checking designs, but some informal testing suggests it isn't quite as accurate as Brettel or Vienot. To validate a simulator, we compare a rainbow grid against the <a href="https://daltonlens.org/colorblindness-simulator">known good models</a>.
        </p>
      </aside>
    </main>
  </body>
</html>